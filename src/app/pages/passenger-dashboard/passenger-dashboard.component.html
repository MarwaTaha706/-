
<div class="w-full h-[450px] rounded-lg overflow-hidden mt-13">
  <div id="map" class="relative w-full h-full"></div>
  <div class="absolute top-40 right-10 gap-4 z-999 flex flex-col">
    <button (click)="setSelectionMode(true)" [ngClass]="{'bg-blue-700 text-white': isSelectingPickup, 'bg-white': !isSelectingPickup}" class="border border-blue-500 text-blue-500 rounded-full p-2 font-semibold hover:bg-blue transition shadow-md transition-transform duration-200 ease-in-out hover:scale-105">
      اختر نقطة الانطلاق
    </button>
    <button (click)="setSelectionMode(false)" [ngClass]="{'bg-blue-700 text-white': !isSelectingPickup, 'bg-white': isSelectingPickup}" class="border border-blue-500 text-blue-500 rounded-full p-2 font-semibold hover:bg-blue-50 transition shadow-md transition-transform duration-200 ease-in-out hover:scale-105">
      اختر نقطة الوصول
    </button>
    <button (click)="getCurrentLocation()" class="border border-cyan-400 text-cyan-500 bg-white rounded-full p-2 font-semibold flex items-center gap-1 hover:bg-cyan-50 transition shadow-md transition-transform duration-200 ease-in-out hover:scale-105">
      استخدم الموقع الحالي
    </button>
    <button (click)="resetLocations()" class="border border-yellow-400 text-yellow-500 bg-white rounded-full p-2 font-semibold hover:bg-yellow-50 transition shadow-md transition-transform duration-200 ease-in-out hover:scale-105">
      إعادة تعيين
    </button>
  </div>
</div>


<div class="w-full flex justify-center mb-20 mt-3 sticky top-19 z-1000">
  <div class="flex flex-row items-center justify-between bg-white rounded-xl shadow border border-gray-400 overflow-hidden w-full max-w-6xl divide-x divide-gray-400 h-15">
   
    <div class="relative w-1/6">
      <img src="add_location_alt.png" alt="" class="absolute right-2 top-1/2 -translate-y-1/2 w-5 h-5">
      <input type="text" placeholder="من" class="w-full py-2 pr-8 pl-6 rounded focus:outline-none text-gray-700" [(ngModel)]="fromLocationText" (input)="onInputChange('from', $event)" />
    </div>
   
    <div class="relative w-1/6">
      <img src="distance.png" alt="" class="absolute right-2 top-1/2 -translate-y-1/2 w-5 h-5">
      <input type="text" placeholder="الى" class="w-full py-2 pr-8 pl-6 rounded focus:outline-none text-gray-700" [(ngModel)]="toLocationText" (input)="onInputChange('to', $event)" />
    </div>
   
    <div class="relative w-1/6">
      <select [(ngModel)]="filterGender" (ngModelChange)="onSearchClick()" class="w-full py-2 px-4 rounded focus:outline-none text-gray-700">
        <option value="">الجنس (الكل)</option>
        <option value="0">ذكر</option>
        <option value="1">أنثى</option>
      </select>
    </div>
  
    <div class="relative w-1/6">
      <select [(ngModel)]="filterStatus" (ngModelChange)="onSearchClick()" class="w-full py-2 px-4 rounded focus:outline-none text-gray-700">
        <option value="">الحالة (الكل)</option>
        <option value="1">مجدولة</option>
        <option value="2">جارية</option>
        <option value="3">مكتملة</option>
        <option value="4">ملغاة</option>
      </select>
    </div>

    <div class="relative w-1/6">
      <input type="date" placeholder="اليوم" class="w-full py-2 px-4 rounded focus:outline-none text-gray-700" [(ngModel)]="filterDate" (change)="onSearchClick()" />
    </div>
 
    <button (click)="onSearchClick()" class="bg-[#364E99] text-white font-bold px-8 py-3 h-full w-1/6">بحث</button>
  </div>
</div>
<div class="welcome-container">
  <p class="welcome-subtitle">
   اكتشف، قارن، واحجز رحلتك المثالية بسهولة وأمان...✨✨
  </p>
</div>


<div *ngIf="isLoading" class="flex justify-center items-center my-12">
    <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600"></div>
</div>


<div *ngIf="!isLoading">
  <div *ngIf="filteredRides.length > 0; else noTripsMessage" class="carousel-container bottom-4">
    
    <button (click)="scrollCards('prev')" class="carousel-arrow prev"><i class="bi bi-chevron-right"></i></button>

    <div class="trip-cards-container" #tripCardsContainer>
      <div *ngFor="let ride of filteredRides" class="trip-card">
        
       
        <div class="trip-status-badge" [ngClass]="{ 'status-scheduled': ride.tripStatus === 1, 'status-ongoing': ride.tripStatus === 2, 'status-completed': ride.tripStatus === 3, 'status-cancelled': ride.tripStatus === 4 }">
          {{ ride.tripStatus === 1 ? 'مجدولة' : (ride.tripStatus === 2 ? 'جارية' : (ride.tripStatus === 3 ? 'مكتملة' : (ride.tripStatus === 4 ? 'ملغاة' : 'غير معروفة'))) }}
        </div>

        <div class="card-header">
          <span>احجز رحلتك مع</span>
        </div>

      
        <div class="card-driver-section">
          <img [src]="getFullImageUrl(ride.driverImageUrl)" alt="صورة السائق" class="driver-image">
          <div class="driver-details">
            <span class="driver-name">{{ ride.driverName }}</span>
            <div class="driver-rating">
              <i class="bi bi-star-fill star-icon"></i>
              <span>{{ ride.rate | number:'1.1-1' }}</span>
            </div>
          </div>
        </div>

      
        <div class="card-route-section">
          <div class="route-point">
            <span class="route-label">من</span>
            <p class="route-city">{{ ride.departureCity }}</p>
          </div>
          <i class="bi bi-arrow-down route-arrow"></i>
          <div class="route-point">
            <span class="route-label">إلى</span>
            <p class="route-city">{{ ride.destinationCity }}</p>
          </div>
        </div>

     
        <div class="card-details-section">
          <div class="detail-item">
            <span class="detail-value">{{ ride.price }} جنيه</span>
            <span class="detail-label">سعر المقعد</span>
          </div>
          <div class="detail-item">
            <span class="detail-value">{{ ride.availableSeats }}</span>
            <span class="detail-label">مقاعد متاحة</span>
          </div>
          <div class="detail-item">
            <span class="detail-value">{{ ride.departureTime | date:'shortTime' }}</span>
            <span class="detail-label">{{ ride.departureTime | date:'MMM d' }}</span>
          </div>
        </div>

        <div class="card-footer">
          <button (click)="navigateToTripDetails(ride.tripId)" class="details-button">
            المزيد من التفاصيل....
          </button>
        </div>
      </div>
    </div>

    <button (click)="scrollCards('next')" class="carousel-arrow next"><i class="bi bi-chevron-left"></i></button>
  </div>

  <div class="pagination-dots" *ngIf="totalPages > 1">
    <span *ngFor="let page of [].constructor(totalPages); let i = index" 
          class="dot" 
          [class.active]="pageNumber === (i + 1)"
          (click)="goToPage(i + 1)">
    </span>
  </div>

  <ng-template #noTripsMessage>
    <div class="no-trips-container">
      <div class="no-trips-message">
        <i class="bi bi-compass no-trips-icon"></i>
        <h3>لم يتم العثور على رحلات</h3>
        <p>جرّب تغيير معايير البحث أو كن أول من يقترح رحلة!</p>
        <button (click)="navigateToSuggestTrip()" class="suggest-trip-button">
          <span>اقترح رحلتك الآن</span>
        </button>
      </div>
    </div>
  </ng-template>
</div>
